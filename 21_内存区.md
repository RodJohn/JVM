
# 1 概述

定义

    JVM Runtime Data Area（运行时数据区）
    是JVM在执行Java程序时管理的内存
    
组成

    线程独享的
        PC计数器，java栈，本地方法区
    线程共享的        
        java堆，方法区组成

 


# 2 程序计数器

概念

    程序计数器（Program Counter Register）
    也称作为PC寄存器

作用

    标记当前线程需要执行的指令
 
过程
    
    在JVM中，
    多线程是通过线程轮流切换来获得CPU执行时间的，
    为了在线程切换后能恢复到正确的执行位置
    每个线程都必须拥有自己的程序计数器，标记自己的执行位置                   
 
特点

    在JVM规范中规定，如果线程执行的是非native方法，则程序计数器中保存的是当前需要执行的指令的地址；
    如果线程执行的是native方法，则程序计数器中的值是undefined。
    
    

# 3 Java虚拟机栈

概念

    Java虚拟机栈（Java Vitual Machine Stack）
    也称作Java栈

作用
    
    Java栈是线程执行Java方法的内存模型
   
过程   
    
    Java栈中存放的是一个个的栈帧
        当线程执行一个方法时，就会随之创建一个对应的栈帧，并将建立的栈帧压栈。
        当方法执行完毕之后，便会将栈帧出栈。

    在栈帧中包括
        局部变量表(Local Variables)、
            就是用来存储方法中的局部变量（包括在方法中声明的非静态变量以及函数形参）。
        操作数栈(Operand Stack)、
            利用栈完成计算过程
        运行时常量池的引用
            因为在方法执行的过程中有可能需要用到类中的常量，所以必须要有一个引用指向运行时常量。
        方法返回地址(Return Address)
            当一个方法执行完毕之后，要返回之前调用它的地方，因此在栈帧中必须保存一个方法返回地址。

    方法返回地址，

特点

    在编译期就确定了

# 4 本地方法栈

概述

    本地方法栈（Native Method Stacks）

作用　

    本地方法栈则是为线程执行本地方法（Native Method）服务的。
    
特点
    
    在JVM规范中，并没有对本地方发展的具体实现方法以及数据结构作强制规定，虚拟机可以自由实现它。
    在HotSopt虚拟机中直接就把本地方法栈和Java栈合二为一。




# 5 堆

概述

    Java Heap （堆）

作用

    线程共享的
    用来存储对象以及数组的
    但是并不是全部的实例对象都在堆中（栈上分配）
 
特点

    在JVM中只有一个堆。
    也是最大的一块内存区域
    
    


# 6 方法区

概述

    方法区（Method Area）
    也叫做 非堆（Non-Heap）

作用

    线程共享的
    存储类的信息（包括类的名称、方法信息、字段信息）、静态变量、常量以及编译器编译后的代码
    在方法区中有一个非常重要的部分就是运行时常量池
    



## 6.1 运行时常量池

概念

    运行时常量池（Runtime Constant Pool）
    是方法区的一部分

作用

    用于存放编译器生成的各种字面量和符号引用，这部分内容将在类加载后存放到运行时常量池中。
  
特点
  
    对于运行时常量池，Java虚拟机规范没有做任何细节的要求，不同的提供商实现的虚拟机可以按照自己的需要来实现这个内存区域。
    不过，一般来说，除了保存Class文件中描述的符号引用外，还会把翻译出来的直接引用也存储在运行时常量池中。
    运行时常量池相对于Class文件常量池的另外一个重要特征是具备动态性，Java语言并不要求常量一定只有编译期才会产生，也就是并非预置入Class文件中常量池的内容才能进入方法区运行时常量池，运行期间也可能将新的常量放入池中，这种特性被开发人员利用的比较多的便是String类的intern()方法。
 
 
## 6.2 方法区和永久代
       
    在JVM规范中，没有强制要求方法区必须实现垃圾回收。很多人习惯将方法区称为“永久代”，
    是因为HotSpot虚拟机以永久代来实现方法区，从而JVM的垃圾收集器可以像管理堆区一样管理这部分区域，从而不需要专门为这部分设计垃圾回收机制。
    不过自从JDK7之后，Hotspot虚拟机便将运行时常量池从永久代移除了。    
    
 
# 7 直接内存

概念

    直接内存（Direct Memory）
    直接内存并不是虚拟机运行时数据区的一部分，也不是Java虚拟机规范中定义的内存区域，
    但是会被JVM虚拟机频繁用到
 
作用
    
    在JDK1.4中新引入了NIO机制，它是一种基于通道与缓冲区的新I/O方式，
    可以直接从操作系统中分配直接内存，即在堆外分配内存，
    这样能在一些场景中提高性能，因为避免了在Java堆和Native堆中来回复制数据。
    它直接从操作系统中分配，因此不受Java堆大小的限制，
    但是会受到本机总内存的大小及处理器寻址空间的限制，
    因此它也可能导致OutOfMemoryError异常出现。
