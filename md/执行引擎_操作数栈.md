
# 操作数栈

作用

    Java虚拟机的解释执行引擎称为“基于栈的执行引擎”，其中所指的“栈”是操作数栈
    虚拟机把操作数栈作为它的工作区
    大多数指令都要从这里弹出数据，执行运算，然后把结果压回操作数栈。
    比如，iadd指令就要从操作数栈中弹出两个整数，执行加法运算，其结果又压回到操作数栈中，

    是一个后入先出栈。
    操作数栈的最大深度在编译的时候写入到 Code属性的max_stacks 数据项中

作业流程




栈帧之间的数据共享

    在概念模型中，两个栈帧作为虚拟机栈的元素，是完全相互独立的。
    但在大多虚拟机实现会做一些优化，令两个栈帧出现一部分重叠。
    让下面的栈帧的部分操作数栈与上面栈帧的部分局部变量表重叠在一起，这样在进行方法调用时就可以共用一部分数据，无需进行额外的参数复制传递。           
    

# 动态连接
    
    （1）作用
    
    每个栈帧都包含一个指向运行时常量池中该栈帧所属方法的引用，持有这个引用是为了支持方法调用过程中的动态连接。
    
    （2）静态解析
    
    在前面几篇博文的讲解中学习了Class文件的常量池中存在大量符号引用，字节码的方法调用指令就以常量池中指向方法的符号作为参数。
    
    这些符号引用一部分会在类加载阶段或第一次使用的时候就转化为直接引用，这种转化称为静态解析；
    
    （3）动态连接
    
    另外一部分将在每一次运行期间转化为直接引用，这部分称为动态连接。
    
# 方法返回地址

    （1）退出正执行的方法
    
    当一个方法执行后，有两种方式退出这个方法：
    
    正常完成出口（Normal Method Invocation Completion）：执行引擎遇到任意一个方法返回的字节码指令，这种退出方法称为正常完成出口。
    
    异常完成出口（Abrupt Method Invocation Completion）：在方法执行过程中遇到了异常，并且这个异常没有在方法体内得到处理，无论是java虚拟机内部产生的异常，还是代码中使用athrow 字节码指令产生的异常。只要在本方法的异常表中没有搜索到匹配的异常处理器，方法就会退出；这种方式称为异常完成出口。
    
    （2）退出方法时可能执行的操作
    
    方法退出的过程实际上就等同于把当前栈帧出栈，因此退出时可能执行的操作有：
    
    恢复上层方法的局部变量表和操作数栈；
    把返回值压入调用者栈帧的操作数栈中，调整PC计数器的值以指向方法调用指令后面的一条指令等。

