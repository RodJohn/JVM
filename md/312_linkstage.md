
# 概述

过程

	类加载由 加载，连接，初始化等三个组成。
	其中连接分为验证，准备，解析

特点

	加载和连接阶段的部分内容是交叉进行的
	过程之间是
	



# 验证阶段

## 概述

作用

    确保被加载的类的正确性

	JVM绑定的是class文件，class文件的生成方式不固定
	（可以通过编译器安全的的生成，也可以手动编写进行生成或者修改）
 
耗时

	校验是比较消耗时间的操作    
	可以使用启动参数-Xverify:none来关闭大部分类验证措施，缩短虚拟机类加载时间。


## 过程    
    
文件格式验证

    比如是否以魔数开头，主次版本号是否在虚拟机可处理范围之内，常量池是否有不支持类型等。
    经过这个阶段的验证之后，字节流才会进入内存的方法区进行存储，
    所以后面的三个验证阶段全部是基于方法区的存储结构进行的。
    
元数据验证

    对字节码描述的信息进行语义分析，以保证其描述的信息符合JAVA语言规范的要求，
	比如，这个类是否有父类，如果不是抽象类是否实现了其父类或接口中要求实现的所有方法

字节码验证
    
    最复杂的一个解读那，主要工作是进行数据流和控制流分析。
    这阶段对类的方法体进行校验分析，保证该方法在运行时不会做出危害JVM安全的行为，
    例如：保证跳转指令不会跳转到方法体以外的字节码指令上，保证方法体中的类型转换是有效的

符号引用验证

    这个阶段发生在虚拟机将符号引用转化为直接引用的时候。
    动作将在解析阶段中发生。
    比如：符号引用中通过字符串描述的全限定名是否能找到对应的类，
    是否存在所描述的方法和字段；符号引用中的类、字段和方法的访问性是否可被当前类访问。

 也就是对应着class文件的格式进行校验   
    
	
# 准备阶段

内存分配

	为类的静态变量在方法区中分配内存
	
设置的初始值

	通常情况下是数据类型默认的零值
	（如0、0L、null；bool类型实际上是int类型所以对应的是false）
	

ConstantValue
    
    同时被static和final修饰并赋予常值的变量，
    在编译时将生成ConstantValue属性，
    在准备阶段将直接设置成该初值。
 
  
# 解析阶段

## 作用

    将符号引用替换为直接引用的内存地址。


## 时机

    虚拟机规范并未规定解析阶段发生的具体时间，
    只要求了在执行操作符号引用的字节码指令之前，先对它们使用的符号引用进行解析。
    可以在类被加载器加载的时候对常量池的符号引用进行解析（也就是初始化之前），还是等到一个符号引用被使用之前进行解析（也就是在初始化之后）。
    
## 流程 

类或接口的解析

	假设当前代码所处的类为D，如果要把一个从未解析过的符号引用N解析为一个类或接口C的直接引用，

	如果C不是一个数组类型，
	那虚拟机将会把代表N的全限定名传递给D的类加载器去加载这个类C。
	在加载过程中，由于元数据验证、字节码验证的需要，又可能触发其他相关类的加载动作，例如加载这个类的父类或实现的接口。
	
	如果C是一个数组类型，并且数组的元素类型为对象，
	那将会按照第1点的规则加载数组元素类型。
	接着由虚拟机生成一个代表此数组维度和元素的数组对象。
	
字段解析

    解析字段的符号引用C。

	如果C本身就包含了简单名称和字段描述符都与目标相匹配的字段，则返回这个字段的直接引用，查找结束。
	否则，如果在C中实现了接口，将会按照继承关系从下往上递归搜索各个接口和他的父接口，如果接口中包含了简单名称和字段描述符都与目标相匹配的字段，则返回这个字段的直接引用，查找结束。
	否则，如果C不是java.lang.Object的话，将会按照继承关系从下往上递归搜索其父类，如果在父类中包含了简单名称和字段描述符都与目标相匹配的字段，则返回这个字段直接引用。
