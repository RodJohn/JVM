
# 方法区

## 概述

    方法区（Method Area）
    也叫做 非堆（Non-Heap）

    方法区是堆的逻辑组成部分，

## 作用

    存储类的元数据（类名称、方法信息、字段信息）
    在方法区中有一个非常重要的部分就是运行时常量池

## 特点

    线程共享  
    内存操作少


# 实现

元空间和永久代都是对方法区的实现

jdk1.7之前

    HotSpot使用永久代来实现了方法区。
    从而JVM的垃圾收集器可以像管理堆区一样管理这部分区域，
    这个区域的内存回收目标主要是针对常量池的回收和对类型的卸载。

jdk1.7

    已经将方法区中的运行时常量池从永久代移除，
    在Java 堆中开辟了一块区域存放运行时常量池。

jdk1.8

    已经彻底没有了永久代，
    用元空间实现方法区
    将方法区直接放在一个与堆不相连的元空间，


永久代物理是是堆的一部分，和新生代，老年代地址是连续的，而元空间属于本地内存；
元空间存储类的元信息，静态变量和常量池等并入堆中。相当于永久代的数据被分到了堆和元空间中。

-XX:MetaspaceSize 
元空间初始大小
-XX:MaxMetaspaceSize  
元空间最大大小
超过这个值将会抛出OutOfMemoryError异常:java.lang.OutOfMemoryError: Metadata space
在jdk1.7中抛出的异常是这样:java.lang.OutOfMemoryError: PermGen


# 元空间
概述

JDK1.8，永久代才完全消失，使用元空间。

特点
元空间是直接存在内存中，不在java虚拟机中的，因此元空间依赖于宿主机内存大小。

优点

JVM在运行时会自动调整元空间大小，不必担心内存设置的过小或者过大。

提高Full GC的性能，在Full GC期间，Metadata到Metadata pointers之间不需要扫描了；

缺点

如果程序存在内存泄露，
不停的扩展metaspace的空间，会导致机器的内存不足。
